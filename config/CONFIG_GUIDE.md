# Руководство по конфигурации Химера 2.0

## Actor System

### Основные настройки
- `ACTOR_SYSTEM_NAME` - имя системы акторов для логирования (по умолчанию: "chimera")
- `ACTOR_MESSAGE_QUEUE_SIZE` - максимальный размер очереди сообщений для каждого актора (по умолчанию: 1000)
- `ACTOR_SHUTDOWN_TIMEOUT` - время ожидания graceful shutdown в секундах (по умолчанию: 5.0)
- `ACTOR_MESSAGE_TIMEOUT` - таймаут ожидания нового сообщения в message loop (по умолчанию: 1.0)

### Retry механизм
- `ACTOR_MESSAGE_RETRY_ENABLED` - включить механизм повторной отправки сообщений при переполнении очереди (по умолчанию: True)
- `ACTOR_MESSAGE_MAX_RETRIES` - максимальное количество попыток отправки сообщения (по умолчанию: 3)
- `ACTOR_MESSAGE_RETRY_DELAY` - начальная задержка между попытками в секундах (по умолчанию: 0.1)
- `ACTOR_MESSAGE_RETRY_MAX_DELAY` - максимальная задержка между попытками в секундах (по умолчанию: 2.0)

### Dead Letter Queue
- `DLQ_MAX_SIZE` - максимальный размер Dead Letter Queue перед автоочисткой (по умолчанию: 1000)
- `DLQ_CLEANUP_INTERVAL` - интервал автоматической очистки DLQ в секундах (по умолчанию: 3600)
- `DLQ_METRICS_ENABLED` - включить сбор метрик по Dead Letter Queue (по умолчанию: True)

## Логирование

### Основные настройки
- `LOG_LEVEL` - уровень логирования (DEBUG, INFO, WARNING, ERROR) (по умолчанию: "INFO")
- `LOG_FORMAT` - формат сообщений логов (по умолчанию: "%(asctime)s - %(name)s - %(levelname)s - %(message)s")
- `LOG_DATE_FORMAT` - формат даты в логах (по умолчанию: "%Y-%m-%d %H:%M:%S")

### JSON логирование
- `ENABLE_JSON_LOGGING` - включить JSON логирование параллельно с текстовым (по умолчанию: True)
- `JSON_LOG_FILE` - путь к файлу JSON логов (по умолчанию: "logs/chimera.json")

### Ротация логов
- `LOG_ROTATION_ENABLED` - включить автоматическую ротацию файлов логов (по умолчанию: True)
- `LOG_MAX_BYTES` - максимальный размер файла логов в байтах перед ротацией (по умолчанию: 1048576 = 1 МБ)
- `LOG_BACKUP_COUNT` - количество архивных файлов логов для хранения (по умолчанию: 5)

## Мониторинг

### Метрики производительности
- `ENABLE_PERFORMANCE_METRICS` - включить сбор метрик производительности (по умолчанию: True)
- `METRICS_LOG_INTERVAL` - интервал логирования метрик в секундах (по умолчанию: 60)
- `SLOW_OPERATION_THRESHOLD` - порог в секундах для определения медленных операций (по умолчанию: 0.1)

## Примечания

1. **Retry механизм** использует exponential backoff - каждая следующая попытка происходит через удвоенное время, но не более `ACTOR_MESSAGE_RETRY_MAX_DELAY`.

2. **Dead Letter Queue** сохраняет сообщения, которые не удалось доставить после всех попыток. Автоочистка удаляет старые сообщения при превышении `DLQ_MAX_SIZE`.

3. **Метрики производительности** логируются только для операций, превышающих `SLOW_OPERATION_THRESHOLD` секунд.

4. **Ротация логов** автоматически архивирует файл логов при достижении `LOG_MAX_BYTES`. Архивные файлы именуются как `chimera.json.1`, `chimera.json.2` и т.д. Когда количество архивов превышает `LOG_BACKUP_COUNT`, самый старый файл удаляется.